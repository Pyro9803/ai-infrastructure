---
# Preflight checks tasks

- name: Verify required variables are set
  ansible.builtin.assert:
    that:
      - tinyllama_deploy_environment is defined
      - tinyllama_deploy_environment in ['dev', 'prod']
    fail_msg: "Environment variable 'tinyllama_deploy_environment' must be set to 'dev' or 'prod'"
    success_msg: "Environment is set to: {{ tinyllama_deploy_environment }}"

- name: Check if kubectl is installed
  ansible.builtin.command: kubectl version --client
  register: tinyllama_deploy_kubectl_version
  changed_when: false
  failed_when: tinyllama_deploy_kubectl_version.rc != 0

- name: Check if gcloud is installed
  ansible.builtin.command: gcloud version
  register: tinyllama_deploy_gcloud_version
  changed_when: false
  failed_when: tinyllama_deploy_gcloud_version.rc != 0

- name: Display tool versions
  ansible.builtin.debug:
    msg:
      - "Kubectl version: {{ tinyllama_deploy_kubectl_version.stdout_lines[0] }}"
      - "Gcloud version: {{ tinyllama_deploy_gcloud_version.stdout_lines[0] }}"
